# TLS Unified - Environment Cleanup and Firebase Setup Session

**Date:** June 3, 2025

## Session Overview

This session focused on standardizing the development environment, cleaning up old Google Cloud and Firebase resources, and establishing a fresh configuration for the TLS Unified project. We addressed multiple environment issues to create a clean, consistent setup.

## Key Actions Performed

### 1. Homebrew Standardization

- Identified PATH configuration issues with manually installed tools
- Created and executed migration script to standardize on Homebrew
- Uninstalled manually installed Google Cloud SDK and Node.js
- Reinstalled tools via Homebrew for consistent PATH management
- Cleaned up and standardized shell configuration files (.zshrc, .zprofile)

### 2. Google Cloud Secrets Manager Cleanup

- Created scripts to audit Google Secrets Manager
- Verified clean state with no existing secrets
- Established naming convention for future secrets
- Set up tools for managing secrets securely

### 3. Firebase Project Cleanup

- Identified old Firebase project (the-law-shop-457607)
- Listed and analyzed resources in the old project
- Confirmed tls-unified as the new project to preserve
- Removed old Firebase project manually through console
- Verified successful deletion of old project

### 4. Fresh Firebase Setup

- Authenticated with Google Cloud (gcloud auth login)
- Set project to tls-unified
- Created new service account for Firebase Admin SDK
- Generated and properly secured service account key
- Updated .gitignore to exclude sensitive files
- Created Firebase Admin SDK configuration
- Set up proper environment variables
- Successfully tested Firestore, Auth, and Storage connections

### 5. Credential Cleanup

- Removed all references to deleted project's service accounts
- Cleaned up local authentication configuration
- Verified that only valid credentials remain
- Confirmed Firebase functionality after cleanup

## Project Structure

```
tls-unified/
├── app/                              # Next.js App Router
│   ├── (auth)/                       # Auth routes group
│   │   ├── login/
│   │   └── register/
│   ├── intake/                       # Client intake form
│   │   └── page.tsx
│   ├── layout.tsx                    # Root layout
│   ├── page.tsx                      # Landing page
│   └── portal/                       # Client portal
│       ├── [clientId]/               # Dynamic client routes
│       │   └── page.tsx
│       └── register/
│           └── page.tsx
├── components/                       # React components
│   ├── forms/
│   └── ui/
├── contexts/                         # React contexts
│   └── AuthContext.tsx
├── docs/                             # Documentation
│   ├── 00-project_overview.md
│   ├── 01-coding_methodology.md
│   └── CC Session Recaps/            # Claude Code session recaps
│       ├── 25.06.02 - 14.08.md
│       ├── 25.06.03 - 11.15 - Firebase Emulators.md
│       └── 25.06.03 - 12.30 - Environment Cleanup.md
├── lib/                              # Shared libraries
│   ├── firebase-admin-key.json       # Service account key (gitignored)
│   ├── firebase-admin.d.ts          # Type declarations
│   ├── firebase-admin.mjs           # Firebase Admin SDK
│   ├── firebase.ts                   # Firebase client SDK
│   ├── test-admin.js                 # Admin SDK test
│   └── test-firebase-admin.mts       # Admin SDK test (ESM)
├── public/                           # Static assets
├── types/                            # TypeScript types
├── .env.local                        # Environment variables (gitignored)
├── firebase.json                     # Firebase configuration
├── firestore.rules                   # Firestore security rules
└── various utility scripts           # Migration and testing scripts
```

## Technical Details

### Firebase Configuration

The project now uses Firebase SDK with proper environment variables:

```typescript
// lib/firebase.ts
import { initializeApp } from 'firebase/app';
import { getAuth, connectAuthEmulator } from 'firebase/auth';
import { getFirestore, connectFirestoreEmulator } from 'firebase/firestore';
import { getStorage, connectStorageEmulator } from 'firebase/storage';

const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

// Connect to emulators in development environment
if (process.env.NODE_ENV === 'development') {
  connectAuthEmulator(auth, 'http://localhost:9099', { disableWarnings: true });
  connectFirestoreEmulator(db, 'localhost', 8080);
  connectStorageEmulator(storage, 'localhost', 9199);
  console.log('Connected to Firebase emulators - Auth:9099, Firestore:8080, Storage:9199');
} else {
  console.log('Using production Firebase services');
}

export { app, auth, db, storage };
```

### Firebase Admin SDK Configuration

```typescript
// lib/firebase-admin.mjs
import { initializeApp, cert, getApps } from 'firebase-admin/app';
import { getFirestore } from 'firebase-admin/firestore';
import { getAuth } from 'firebase-admin/auth';
import { getStorage } from 'firebase-admin/storage';
import serviceAccount from './firebase-admin-key.json';

// Check if the Firebase Admin SDK has already been initialized
const adminApp = !getApps().length
  ? initializeApp({
      credential: cert(serviceAccount as any),
      storageBucket: `${serviceAccount.project_id}.appspot.com`,
    })
  : getApps()[0];

// Initialize Firestore, Auth, and Storage
const adminDb = getFirestore(adminApp);
const adminAuth = getAuth(adminApp);
const adminStorage = getStorage(adminApp);

export { adminApp, adminDb, adminAuth, adminStorage };
```

## Final Status

✅ Homebrew standardization complete  
✅ All tools properly installed via Homebrew  
✅ Old Firebase project successfully deleted  
✅ Google Secrets Manager verified clean  
✅ New Firebase service account created and configured  
✅ Firebase Admin SDK working correctly  
✅ All old credentials removed from local machine  
✅ Environment variables properly configured  
✅ Project ready for development

## Next Steps

1. Implement user authentication
2. Set up Firestore data models
3. Create document management functionality
4. Configure client portal UI
5. Implement role-based access controls

## Notes

- Project follows TLS coding methodology focusing on lightweight simplicity
- Firebase emulators can be used for local development
- All credentials are secured and not committed to git
- New service account name: firebase-admin-tls-unified
- Environment standardized on Homebrew for consistency
