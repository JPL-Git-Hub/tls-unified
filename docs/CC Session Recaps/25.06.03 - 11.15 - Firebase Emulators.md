# TLS Unified - Firebase Emulators Setup Session

**Date:** June 3, 2025

## Session Overview
This session focused on configuring Firebase emulators for local development of the TLS Unified client portal system. We resolved authentication issues and implemented a development environment that connects to local Firebase emulators.

## Key Actions Performed

### 1. Environment Setup
- Installed Firebase CLI globally using npm
- Installed OpenJDK 11 via Homebrew (required for Firebase emulators)
- Verified both installations were working correctly

### 2. Firebase Emulator Configuration
- Created Firebase configuration files:
  - `firebase.json` - Configured auth and firestore emulators
  - `firestore.rules` - Set up basic security rules
  - `firestore.indexes.json` - Empty indexes file for future use

### 3. Firebase Integration
- Updated `lib/firebase.ts` to conditionally connect to emulators in development
- Added emulator connection for Auth (port 9099)
- Added emulator connection for Firestore (port 8080)
- Maintained production configuration for deployed environments

### 4. Client Portal Implementation
- Created a basic client portal page at `/app/portal/[clientId]/page.tsx`
- Implemented dynamic routing to capture the client ID
- Added minimal UI with Tailwind CSS following TLS principles

## Project Structure
```
tls-unified/
├── app/
│   ├── (auth)/
│   │   ├── login/
│   │   └── register/
│   ├── (marketing)/
│   ├── favicon.ico
│   ├── globals.css
│   ├── intake/
│   │   └── page.tsx           # Client intake form
│   ├── layout.tsx
│   ├── page-original.tsx
│   ├── page.tsx               # Main landing page
│   └── portal/
│       ├── [clientId]/
│       │   └── page.tsx       # Client portal page (NEW)
│       └── register/
│           └── page.tsx       # Portal registration
├── components/
│   ├── forms/
│   └── ui/
├── contexts/
│   └── AuthContext.tsx
├── docs/
│   ├── 00-project_overview.md
│   ├── 01-coding_methodology.md
│   └── CC Session Recaps/
│       ├── 25.06.02 - 14.08.md
│       └── 25.06.03 - Firebase Emulators.md  # This document
├── firebase.json              # Firebase emulator config (NEW)
├── firestore.rules            # Firestore security rules (NEW)
├── firestore.indexes.json     # Firestore indexes (NEW)
├── lib/
│   └── firebase.ts            # Updated for emulators
├── public/
│   ├── file.svg
│   ├── globe.svg
│   ├── next.svg
│   ├── vercel.svg
│   └── window.svg
├── types/
│   └── index.ts
└── [Configuration files]
```

## Technical Details

### Firebase Emulator Configuration (`firebase.json`)
```json
{
  "firestore": {
    "database": "(default)",
    "location": "nam5",
    "rules": "firestore.rules",
    "indexes": "firestore.indexes.json"
  },
  "emulators": {
    "auth": {
      "port": 9099
    },
    "firestore": {
      "port": 8080
    },
    "ui": {
      "enabled": true
    },
    "singleProjectMode": true
  }
}
```

### Firebase Integration (`lib/firebase.ts`)
```typescript
import { initializeApp } from 'firebase/app'
import { getAuth, connectAuthEmulator } from 'firebase/auth'
import { getFirestore, connectFirestoreEmulator } from 'firebase/firestore'

const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID
}

// Initialize Firebase
const app = initializeApp(firebaseConfig)
const auth = getAuth(app)
const db = getFirestore(app)

// Connect to emulators in development environment
if (process.env.NODE_ENV === 'development') {
  // Connect to Auth emulator
  connectAuthEmulator(auth, 'http://localhost:9099', { disableWarnings: true })
  
  // Connect to Firestore emulator
  connectFirestoreEmulator(db, 'localhost', 8080)
  
  console.log('Connected to Firebase emulators - Auth:9099, Firestore:8080')
} else {
  console.log('Using production Firebase services')
}

export { auth, db }
```

### Client Portal Page (`app/portal/[clientId]/page.tsx`)
```tsx
'use client'

import { useParams } from 'next/navigation'

export default function ClientPortal() {
  const { clientId } = useParams()
  
  return (
    <div className="min-h-screen bg-gray-50 p-6">
      <div className="max-w-4xl mx-auto">
        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
          <h1 className="text-2xl font-bold text-gray-900 mb-2">
            Welcome to your Law Shop Portal
          </h1>
          <p className="text-gray-600">
            Client ID: {clientId}
          </p>
        </div>
        
        <div className="bg-white rounded-lg shadow-md p-6">
          <h2 className="text-xl font-semibold mb-4">Your Documents</h2>
          <div className="p-8 text-center text-gray-500 border border-dashed border-gray-300 rounded-lg">
            <p>No documents yet</p>
            <p className="text-sm mt-2">Your attorney will upload documents for you to review here.</p>
          </div>
        </div>
      </div>
    </div>
  )
}
```

## Running the Application with Emulators

1. Start the Firebase emulators:
   ```bash
   npx firebase emulators:start
   ```

2. In a separate terminal, start the Next.js development server:
   ```bash
   npm run dev
   ```

3. The application will automatically connect to the local emulators for Auth and Firestore.

## Next Steps

1. Implement full authentication flow with emulators
2. Add document upload and management functionality
3. Develop user profile management
4. Implement notifications for new documents
5. Complete responsive design for mobile devices

## Notes

- Firebase emulators require Java Runtime Environment (JDK 11+)
- Local development should work without needing actual Firebase API keys
- When deployed to production, the app will automatically connect to real Firebase services